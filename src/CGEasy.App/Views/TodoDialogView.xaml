<Window x:Class="CGEasy.App.Views.TodoDialogView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:ui="http://schemas.modernwpf.com/2019"
        mc:Ignorable="d"
        Title="{Binding WindowTitle}" 
        Height="700" Width="800"
        MinHeight="600" MinWidth="700"
        WindowStartupLocation="CenterOwner"
        ui:WindowHelper.UseModernWindowStyle="True"
        Background="{DynamicResource SystemControlPageBackgroundChromeLowBrush}">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Form -->
        <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto">
            <StackPanel>
                
                <!-- Titolo -->
                <TextBlock Text="ðŸ“ Titolo *" FontWeight="SemiBold" Margin="0,0,0,5"/>
                <TextBox Text="{Binding Titolo, UpdateSourceTrigger=PropertyChanged}"
                         ui:ControlHelper.PlaceholderText="Inserisci titolo TODO (min 3 caratteri)"
                         Height="40" FontSize="14" Margin="0,0,0,15"/>

                <!-- Descrizione -->
                <TextBlock Text="ðŸ“„ Descrizione" FontWeight="SemiBold" Margin="0,0,0,5"/>
                <TextBox Text="{Binding Descrizione, UpdateSourceTrigger=PropertyChanged}"
                         ui:ControlHelper.PlaceholderText="Descrizione dettagliata del TODO"
                         Height="80" TextWrapping="Wrap" AcceptsReturn="True"
                         VerticalScrollBarVisibility="Auto" FontSize="13" Margin="0,0,0,15"/>

                <!-- Riga 1: Categoria, PrioritÃ , Stato -->
                <Grid Margin="0,0,0,15">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="10"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="10"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Categoria -->
                    <StackPanel Grid.Column="0">
                        <TextBlock Text="ðŸ·ï¸ Categoria *" FontWeight="SemiBold" Margin="0,0,0,5"/>
                        <ComboBox SelectedItem="{Binding CategoriaSelezionata}"
                                  ItemsSource="{Binding Categorie}"
                                  Height="36" FontSize="13"/>
                    </StackPanel>

                    <!-- PrioritÃ  -->
                    <StackPanel Grid.Column="2">
                        <TextBlock Text="âš¡ PrioritÃ  *" FontWeight="SemiBold" Margin="0,0,0,5"/>
                        <ComboBox SelectedItem="{Binding PrioritaSelezionata}"
                                  ItemsSource="{Binding Priorita}"
                                  Height="36" FontSize="13"/>
                    </StackPanel>

                    <!-- Stato -->
                    <StackPanel Grid.Column="4">
                        <TextBlock Text="ðŸ”„ Stato *" FontWeight="SemiBold" Margin="0,0,0,5"/>
                        <ComboBox SelectedItem="{Binding StatoSelezionato}"
                                  ItemsSource="{Binding Stati}"
                                  Height="36" FontSize="13"/>
                    </StackPanel>
                </Grid>

                <!-- Riga 2: Tipo Pratica, Cliente, Data Inizio -->
                <Grid Margin="0,0,0,15">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="10"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="10"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Tipo Pratica -->
                    <StackPanel Grid.Column="0">
                        <TextBlock Text="ðŸ“ Tipo Pratica" FontWeight="SemiBold" Margin="0,0,0,5"/>
                        <ComboBox SelectedItem="{Binding TipoPraticaSelezionata}"
                                  ItemsSource="{Binding TipiPratica}"
                                  DisplayMemberPath="NomePratica"
                                  Height="36" FontSize="13"/>
                    </StackPanel>

                    <!-- Cliente -->
                    <StackPanel Grid.Column="2">
                        <TextBlock Text="ðŸ‘¥ Cliente (opzionale)" FontWeight="SemiBold" Margin="0,0,0,5"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="5"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <ComboBox Grid.Column="0"
                                      SelectedItem="{Binding ClienteSelezionato}"
                                      ItemsSource="{Binding Clienti}"
                                      DisplayMemberPath="NomeCliente"
                                      Height="36" FontSize="13"/>
                            
                            <Button Grid.Column="2" Content="âœ–ï¸" 
                                    Command="{Binding ClearClienteCommand}"
                                    Width="36" Height="36"
                                    ToolTip="Rimuovi cliente"
                                    Background="#F44336" Foreground="White" FontSize="12"/>
                        </Grid>
                        <TextBlock Text="ðŸ’¡ Clicca âœ–ï¸ per rimuovere il cliente" 
                                   FontSize="10" Foreground="#666" Margin="0,3,0,0"/>
                    </StackPanel>

                    <!-- Data Inizio -->
                    <StackPanel Grid.Column="4">
                        <TextBlock Text="ðŸ“… Data Inizio (opzionale)" FontWeight="SemiBold" Margin="0,0,0,5"/>
                        <DatePicker SelectedDate="{Binding DataInizio}"
                                    Height="36" FontSize="13"/>
                    </StackPanel>
                </Grid>

                <!-- Riga 3: Orario Inizio, Data Scadenza, Orario Scadenza -->
                <Grid Margin="0,0,0,15">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="10"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="10"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Orario Inizio -->
                    <StackPanel Grid.Column="0">
                        <TextBlock Text="ðŸ• Orario Inizio (opzionale)" FontWeight="SemiBold" Margin="0,0,0,5"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="5"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <TextBox Grid.Column="0"
                                     Text="{Binding OrarioInizio, StringFormat=hh\\:mm, UpdateSourceTrigger=LostFocus}"
                                     Height="36" FontSize="13"
                                     ui:ControlHelper.PlaceholderText="HH:mm (es. 09:00)"/>
                            
                            <Button Grid.Column="2" Content="âœ–ï¸" 
                                    Command="{Binding ClearOrarioInizioCommand}"
                                    Width="36" Height="36"
                                    ToolTip="Rimuovi orario"
                                    Background="#F44336" Foreground="White" FontSize="12"/>
                        </Grid>
                    </StackPanel>

                    <!-- Data Scadenza -->
                    <StackPanel Grid.Column="2">
                        <TextBlock Text="ðŸ“… Data Scadenza" FontWeight="SemiBold" Margin="0,0,0,5"/>
                        <DatePicker SelectedDate="{Binding DataScadenza}"
                                    Height="36" FontSize="13"/>
                    </StackPanel>

                    <!-- Orario Scadenza (Fine) -->
                    <StackPanel Grid.Column="4">
                        <TextBlock Text="ðŸ• Orario Fine (opzionale)" FontWeight="SemiBold" Margin="0,0,0,5"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="5"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <TextBox Grid.Column="0"
                                     Text="{Binding OrarioFine, StringFormat=hh\\:mm, UpdateSourceTrigger=LostFocus}"
                                     Height="36" FontSize="13"
                                     ui:ControlHelper.PlaceholderText="HH:mm (es. 18:00)"/>
                            
                            <Button Grid.Column="2" Content="âœ–ï¸" 
                                    Command="{Binding ClearOrarioFineCommand}"
                                    Width="36" Height="36"
                                    ToolTip="Rimuovi orario"
                                    Background="#F44336" Foreground="White" FontSize="12"/>
                        </Grid>
                    </StackPanel>
                </Grid>

                <!-- Professionisti Assegnati -->
                <TextBlock Text="ðŸ‘¤ Professionisti Assegnati *" FontWeight="SemiBold" Margin="0,0,0,5"/>
                <Border BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="4" 
                        Background="White" Padding="10" Margin="0,0,0,15">
                    <ScrollViewer MaxHeight="150" VerticalScrollBarVisibility="Auto">
                        <ItemsControl ItemsSource="{Binding ProfessionistiDisponibili}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <CheckBox IsChecked="{Binding IsSelected}"
                                              Content="{Binding DisplayName}"
                                              Margin="0,3" FontSize="13"/>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </Border>

                <!-- Note -->
                <TextBlock Text="ðŸ“Œ Note" FontWeight="SemiBold" Margin="0,0,0,5"/>
                <TextBox Text="{Binding Note, UpdateSourceTrigger=PropertyChanged}"
                         ui:ControlHelper.PlaceholderText="Note aggiuntive opzionali"
                         Height="80" TextWrapping="Wrap" AcceptsReturn="True"
                         VerticalScrollBarVisibility="Auto" FontSize="13" Margin="0,0,0,15"/>

                <!-- Info -->
                <Border Background="#E3F2FD" BorderBrush="#2196F3" BorderThickness="1" 
                        CornerRadius="4" Padding="12" Margin="0,5,0,0">
                    <StackPanel>
                        <TextBlock Text="â„¹ï¸ Informazioni" FontWeight="SemiBold" Foreground="#1976D2" Margin="0,0,0,5"/>
                        <TextBlock TextWrapping="Wrap" Foreground="#1976D2" FontSize="12">
                            <Run Text="â€¢ Campi con asterisco (*) sono obbligatori"/>
                            <LineBreak/>
                            <Run Text="â€¢ Devi assegnare almeno un professionista"/>
                            <LineBreak/>
                            <Run Text="â€¢ Il titolo deve avere almeno 3 caratteri"/>
                        </TextBlock>
                    </StackPanel>
                </Border>

            </StackPanel>
        </ScrollViewer>

        <!-- Pulsanti -->
        <Grid Grid.Row="1" Margin="0,15,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="10"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0" Orientation="Horizontal">
                <TextBlock Text="* = Campo obbligatorio" FontSize="12" Foreground="#666" VerticalAlignment="Center"/>
            </StackPanel>

            <Button Grid.Column="1" Content="âŒ Annulla" Command="{Binding CancelCommand}"
                    Height="40" Width="120" FontSize="14"/>
            
            <Button Grid.Column="3" Content="âœ… Salva" Command="{Binding SaveCommand}"
                    Height="40" Width="120" FontSize="14" FontWeight="SemiBold"
                    Style="{StaticResource AccentButtonStyle}"/>
        </Grid>
    </Grid>
</Window>

